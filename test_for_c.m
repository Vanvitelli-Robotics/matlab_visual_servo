clear all

addpath('lib\')

Ts = 0.1;

s = [
    0.380069468021637
  -0.460605620814666
  -0.866538897887270
   0.374693541784806
  -0.434364056314666
  -0.857457063838550
   0.367296884468091
  -0.444633532913005
  -0.832162255854790
   0.362153808125223
  -0.444070295456243
  -0.880878080073403
  ];

s_star = [
    -0.050000000000000
  -0.050000000000000
   0.050000000000000
  -0.030000000000000
  -0.050000000000000
   0.030000000000000
  -0.010000000000000
  -0.050000000000000
   0.050000000000000
  -0.050000000000000
  -0.030000000000000
   0.030000000000000
   ];

s_star = [
-0.158169617329130
  -0.519819030541916
  -0.361195080298831
  -0.136582649957188
  -0.504988991821822
  -0.371875566769177
  -0.125662882495560
  -0.502200864599999
  -0.345933611847103
  -0.163198486149962
  -0.496882160715269
  -0.376962466922439
  ];

s_star_next = [
    -0.166762670419429
  -0.419300257492869
  -0.252628632573551
  -0.144526204875793
  -0.408133927674384
  -0.266076780346068
  -0.130944518941017
  -0.405472763215720
  -0.241409879225476
  -0.170215942774988
  -0.396768844405780
  -0.269374089698912
    ];

% optimized
% vmax = inf;
% wmax = inf;
% % ambdaT_opt = 0.496204455288576

% vmax = 0.1;
% wmax = 0.1;
% % ambdaT_opt = 0.009850815541419

vmax = 0.01;
wmax = 0.01;
% ambdaT_opt = 9.850815359875602e-04

% analitic
% lambdaT_analitic = 0.496204455336098

% fa

fa_ref_vel = [
    -0.864000000000000
  -0.959554531466593
  -0.648877345717550
   0.628041396696827
  -0.950652463838417
   1.405817117127569
   ];
% vf (open_loop) =
%   -0.820915056612296
%   -0.968387433668448
%   -0.655650604999959
%    0.598024979538481
%   -0.905217272659339
%    1.338627926640972

% vf (closed_loop) =
% -0.210990910625633
% -0.715920169552853
% -1.327594675674171
% -0.392474322225567
% -0.288387520302472
%  0.127571041439679

ek = s-s_star;
Ds_stark = s_star_next - s_star;

forward_action_enabled = false; use_majorant = false;
lambdaT_opt = opt_problem_lambdaT(ek,s_star,vmax*Ts,wmax*Ts,zeros(numel(ek)),forward_action_enabled, use_majorant)


lambdaT_analitic = computeAnaliticLambdaTMax(ek,computeL(s),zeros(numel(ek)))

[vf, funval, exitflag] = computeForwardAction(s_star, s_star_next, Ts, fa_ref_vel)
[vf, funval, exitflag] = computeForwardAction(s_star, s_star_next, Ts, fa_ref_vel,s)